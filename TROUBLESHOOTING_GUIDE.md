# Руководство по устранению неполадок Panorama 360 App

## Проблема: Черный экран при просмотре панорам

### Симптомы:
- При открытии панорамы отображается черный экран
- В консоли браузера ошибки "Failed to fetch"
- Диагностические инструменты показывают "Not Found" ошибки

### Возможные причины и решения:

## 1. Бэкенд сервер не запущен или работает неправильно

### Проверка:
1. Убедитесь, что в терминале бэкенда нет ошибок
2. Откройте в браузере: http://localhost:5000/api/health
3. Должен отобразиться JSON с информацией о состоянии сервера

### Решение:
1. Закройте все терминалы с серверами
2. Запустите `start_servers.bat` от имени администратора
3. Дождитесь полной загрузки обоих серверов (5-10 секунд)

## 2. Проблемы с импортами в API файлах

### Проверка:
Мы уже исправили эту проблему, добавив недостающие импорты в [panorama_api.py](file:///c:/Users/nismo/Desktop/PanoramaSite/backend/panorama_api.py):

```python
# Было:
from models import User, Panorama

# Стало:
from models import User, Panorama, Tour, TourPanorama
```

### Если проблема повторяется:
1. Откройте файл [backend/panorama_api.py](file:///c:/Users/nismo/Desktop/PanoramaSite/backend/panorama_api.py)
2. Убедитесь, что в верхней части файла есть правильные импорты:
   ```python
   from models import User, Panorama, Tour, TourPanorama
   ```

## 3. Проблемы с CORS

### Проверка:
1. Откройте инструменты разработчика (F12)
2. Перейдите на вкладку Network
3. Попробуйте загрузить панораму
4. Проверьте, есть ли ошибки CORS

### Решение:
Мы уже обновили настройки CORS в [backend/config.py](file:///c:/Users/nismo/Desktop/PanoramaSite/backend/config.py):

```python
CORS(app, 
     origins=['http://localhost:3000', 'http://127.0.0.1:3000', 'http://10.8.0.2:3000', 'http://localhost:5173', '*'],
     methods=['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
     allow_headers=['Content-Type', 'Authorization', 'X-Requested-With'],
     supports_credentials=True,
     expose_headers=['Content-Type', 'Authorization'],
     max_age=3600)
```

## 4. Проблемы с базой данных

### Проверка:
1. Убедитесь, что файл `panorama_site.db` существует в папке `backend/`
2. Проверьте, что в таблице `panoramas` есть записи
3. Убедитесь, что файлы панорам существуют в папке `uploads/`

### Решение:
1. Если база данных отсутствует, она будет создана автоматически при запуске
2. Создайте тестовую панораму через интерфейс приложения
3. Авторизуйтесь как admin / 209030Tes!

## 5. Проблемы с путями к файлам

### Проверка:
1. Убедитесь, что папка `uploads/` существует в корне проекта
2. Проверьте права доступа к папке

### Решение:
1. Создайте папку `uploads/` в корне проекта, если она отсутствует
2. Убедитесь, что у сервера есть права на чтение/запись в эту папку

## 6. Проблемы с прокси Vite

### Проверка:
Проверьте файл [frontend/vite.config.ts](file:///c:/Users/nismo/Desktop/PanoramaSite/frontend/vite.config.ts):

```typescript
server: {
  port: 3000,
  host: '0.0.0.0',
  proxy: {
    '/api': {
      target: 'http://localhost:5000',
      changeOrigin: true,
    },
  },
},
```

### Решение:
Если прокси не работает:
1. Перезапустите оба сервера
2. Убедитесь, что бэкенд запущен на порту 5000

## Диагностические инструменты:

### 1. API Test Tool
Откройте: http://localhost:3000/api_test_tool.html
- Проверяет подключение к API
- Тестирует загрузку панорам
- Проверяет CORS настройки

### 2. Image Loading Test
Откройте: http://localhost:3000/test_image_loading.html
- Проверяет загрузку изображений панорам
- Отображает информацию о панорамах

### 3. Backend Test Script
Запустите: `python test_backend_connectivity.py`
- Проверяет базовую доступность бэкенда
- Тестирует ключевые API endpoints

## Пошаговая проверка:

1. **Закройте все терминалы и серверы**
2. **Запустите `start_servers.bat` от имени администратора**
3. **Дождитесь запуска обоих серверов (5-10 секунд)**
4. **Откройте http://localhost:3000/api_test_tool.html**
5. **Выполните все тесты и проверьте результаты**
6. **Если тесты прошли успешно, попробуйте открыть панораму**

## Если проблема сохраняется:

1. **Проверьте логи бэкенда** на наличие ошибок
2. **Убедитесь, что порты 3000 и 5000 свободны**
3. **Проверьте настройки брандмауэра Windows**
4. **Попробуйте перезагрузить компьютер**

## Частые ошибки:

1. **"Failed to fetch"** - бэкенд не запущен или недоступен
2. **"Not Found"** - маршрут не существует или неправильно настроен
3. **CORS errors** - неправильные настройки CORS
4. **Black screen** - текстура не загружена или не применена

## Контактная информация:

Если проблема не решена:
1. Сделайте скриншоты консоли браузера
2. Скопируйте логи бэкенда
3. Отправьте результаты диагностики из API Test Tool