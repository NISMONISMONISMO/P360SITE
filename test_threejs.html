<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест Three.js для панорам</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            font-family: Arial, sans-serif;
            color: white;
        }
        #container {
            width: 100vw;
            height: 100vh;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            z-index: 100;
        }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <div id="info">
        <h3>Тест Three.js для панорам</h3>
        <p>Если вы видите эту надпись, значит Three.js загрузился</p>
    </div>
    
    <div id="loading">
        <p>Загрузка тестовой панорамы...</p>
        <p>Если черный экран, значит проблема в Three.js или WebGL</p>
    </div>
    
    <div id="container"></div>

    <script>
        // Проверим, поддерживает ли браузер WebGL
        function checkWebGLSupport() {
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                return !!gl;
            } catch (e) {
                return false;
            }
        }
        
        if (!checkWebGLSupport()) {
            document.getElementById('loading').innerHTML = 
                '<p style="color: red;">❌ WebGL не поддерживается браузером!</p>' +
                '<p>Попробуйте обновить браузер или включить WebGL в настройках</p>';
        } else {
            document.getElementById('info').innerHTML += 
                '<p style="color: green;">✅ WebGL поддерживается</p>';
        }
        
        // Инициализация Three.js
        let scene, camera, renderer, sphere;
        
        function init() {
            const container = document.getElementById('container');
            
            // Создание сцены
            scene = new THREE.Scene();
            
            // Создание камеры
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 0, 0);
            
            // Создание рендерера
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.setClearColor(0x000000, 1);
            container.appendChild(renderer.domElement);
            
            // Создание сферы
            const geometry = new THREE.SphereGeometry(500, 64, 32);
            geometry.scale(-1, 1, 1);
            
            // Создание тестовой текстуры
            const canvas = document.createElement('canvas');
            canvas.width = 1024;
            canvas.height = 512;
            const ctx = canvas.getContext('2d');
            
            // Создание градиентного фона
            const gradient = ctx.createLinearGradient(0, 0, 1024, 512);
            gradient.addColorStop(0, '#1e3a8a');
            gradient.addColorStop(0.5, '#3b82f6');
            gradient.addColorStop(1, '#1e40af');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 1024, 512);
            
            // Добавление тестовых элементов
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.font = 'bold 40px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Тестовая Панорама', 512, 100);
            
            // Добавление направлений
            ctx.font = '30px Arial';
            ctx.fillText('СЕВЕР', 512, 200);
            ctx.fillText('ЮГ', 512, 450);
            ctx.fillText('ЗАПАД', 150, 250);
            ctx.fillText('ВОСТОК', 850, 250);
            
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.MeshBasicMaterial({ 
                map: texture,
                side: THREE.BackSide
            });
            
            sphere = new THREE.Mesh(geometry, material);
            scene.add(sphere);
            
            // Скрыть загрузку
            document.getElementById('loading').style.display = 'none';
            
            // Запустить анимацию
            animate();
            
            // Обработчики изменения размера окна
            window.addEventListener('resize', onWindowResize);
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            // Медленное вращение для теста
            if (sphere) {
                sphere.rotation.y += 0.002;
            }
            
            renderer.render(scene, camera);
        }
        
        // Запуск инициализации
        window.addEventListener('load', init);
    </script>
</body>
</html>